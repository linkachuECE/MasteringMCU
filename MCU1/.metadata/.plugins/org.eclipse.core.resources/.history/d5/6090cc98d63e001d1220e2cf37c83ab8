/*
 * 008I2C_Arduino.c
 *
 *  Created on: Sep 27, 2022
 *      Author: linkachu
 */

#include "stm32f407xx.h"

void delay(uint16_t ms){
	for(uint32_t i = 0; i < (ms*1000); i++);
}

void USRBTN_Init(GPIO_Handle_t* USRPB){
	USRPB->pGPIOx = GPIOA;
	USRPB->GPIO_PinConfig.GPIO_PinNumber = GPIO_PIN_NO_0;
	USRPB->GPIO_PinConfig.GPIO_PinMode = GPIO_MODE_IT_RT;
	USRPB->GPIO_PinConfig.GPIO_PinSpeed = GPIO_SPEED_FAST;
	USRPB->GPIO_PinConfig.GPIO_PinPuPdControl = GPIO_NO_PUPD;

	GPIO_Init(USRPB);
}

void I2C2_Init(I2C_Handle_t *I2CHandle){
	I2CHandle->I2C_Config.AckControl = I2C_ACK_ENABLE;
	I2CHandle->I2C_Config.DeviceAddress = 0x7F;
	I2CHandle->I2C_Config.FMDutyCycle = I2C_FM_DUTY_2;
	I2CHandle->I2C_Config.SCLSpeed = I2C_SCL_SPEED_SM;

	I2C_Init(I2CHandle);
}

int main(){
	GPIO_Handle_t USRPB;
	USRBTN_Init(&USRPB);

	I2C_Handle_t I2C2;
	I2C2_Init(&I2C2);


}

void EXTI0_IRQHandler(void){
	delay(200);
	GPIO_IRQHandling(GPIO_PIN_NO_0);
	sendMessage();
}
